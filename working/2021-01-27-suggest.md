_2021-01-27 : Suggest Control_

# Suggest Control Working Document


## Summary
The need for a `HTML.SELECT`-type control for **HAL-FORMS** has been clear for quite a while. After several excellent attempts, this is an effort aimed at knocking out a workable solution ASAP. It might not meet all needs right away, but hopefully it is useful and, if needed, can be expanded down the line.

The hope is that we can commit an acceptable version of this feature with the next several days.

This doc is here to allow people to review and comment on the initial design. 

### Suggest Control
The motivation for the control is to provide an enumerated list of possible values for a `property`. This can be used to provide a UI similar to HTML controls such as 

 * `SELECT & OPTIONS`
 * `INPUT.type="radio"`
 * `INPUT.type="checkbox"`
 * `INPUT.type="search"` (w/ type-ahead suggestions)

#### General Functionality
The `suggest` object is a child of `property`. It contains a set of possible values accessible either byValue or byRef (see below for details). The `suggest` control can be rendered as a fixed dropdown list, a set of radio buttons, or as an open field that supports "type-ahead" autocompletion. Whatever value is ultimately selected gets placed into the `property.value` attribute. If the template already has a value in the `property.value` attribute, the UI can render the form with the control showing the "pre-selected" value.

There are a number of possible "renditions" of the `suggest` feature. This spec covers the following:

 * SUGGEST with a Simple Inline Array of Values
 * SUGGEST with an Inline Array of Name/Value Pairs
 * SUGGEST with an External Array of Values
 * SUGGEST with an External Array of Name/Value Pairs
 * SUGGEST with Reference Fields
 
NOTE:  possible return formats

 * text/plain
 * text/csv
 * application/json
 
#### SUGGEST with a Simple Inline Array of Values
Below is a simple rendition of the `suggest` control using the _Inline Array_ style.  Not that, in the example below control's default value would be set to "FedEx".

```javascript
{
  "_templates" : {
    "default" : {
      ...
      "properties" : [
        {
          "name" : "shipping", 
          "value" : "FedEx", 
          "prompt" : "Select Shipping Method", 
          "suggest" : {
            "inline" : ["FedEx","UPS","DHL","Prime"]
          }
        }
      ]
    }
  }
}
```
A corresponding `HTML.SELECT` rendering looks like this:

```html
<label for="shipping">Select Shipping Method</label>
<select name="shipping">
  <option selected="true">FedEx</option>
  <option>UPS</option>
  <option>DHL</option>
</select>
```

#### SUGGEST with an Inline Array of Name/Value Pairs
Below is an example of the SUGGEST control using an _Inline Array of Name/Value Paris_.

```javascript
{
  "_templates" : {
    "default" : {
      ...
      "properties" : [
        {
          "name" : "shipping", 
          "value" : "FedEx", 
          "prompt" : "Select Shipping Method", 
          "suggest" : {
            "inline" : [
              {"prompt" : "Federal Express", "value" : "FedEx"},
              {"prompt" : "United Parcel Service", "value" : "UPS"},
              {"prompt" : "DHL Express", "value" : "DHL"},
            ]
          }
        }
      ]
    }
  }
}
```

A corresponding `HTML.INPUT.type="radio"` rendering looks like this:

```html
<p>
  <input type="radio" id="fedex" name="shipping" value="FedEx" checked="true">
  <label for="fedex">Federal Express</label><br>
  
  <input type="radio" id="ups" name="shipping" value="UPS">
  <label for="ups">United Parcel Service</label><br>
  
  <input type="radio" id="dhl" name="shipping" value="DHL">
  <label for="dhl">DHL Express</label>
</p>
```

#### SUGGEST with an External Array of Values
The source of possible values for a `suggest` control can also be an external resource. This resource is reachable using an `HTML.GET` against a supplied URL and and OPTIONAL `accept` property that holds a valid registered media type (e.g. `text/plain`, `application/json`, etc. 

By default, the response value is a _Simple Array_ rendered in `text/plain` as a set of comma-separated values.

```javascript
{
  "_templates" : {
    "default" : {
      ...
      "properties" : [
        {
          "name" : "shipping", 
          "value" : "FedEx", 
          "prompt" : "Select Shipping Method", 
          "suggest" : {
            "resource" : {
              "href" : "http://api.examples.org/shipping-options"
            }
          }
        }
      ]
    }
  }
}
```
The client would derefernce the URL using `HTTP.GET`. The exchange (including the response) looks like this:

```
*** REQUEST
GET /shipping-options HTTP/2.0
Host: api.example.org
Accept: text/plain

*** RESPONSE
HTTP/2.0 200 OK
Content-Type: text/plain
Content-Length: nn

Fedex,UPS,DHL
```

**NOTE:** An array of values MAY be returned as a simple JSON array if the `suggest.accept` attribute is set to `application/json`

```
*** REQUEST
GET /shipping-options HTTP/2.0
Host: api.example.org
Accept: application/json

*** RESPONSE
HTTP/2.0 200 OK
Content-Type: application/json
Content-Length: nn

["Fedex","UPS","DHL"]
```

#### SUGGEST with an External Array of Name/Value Pairs
The external resource MAY return a collection of name/value pairs.

```javascript
{
  "_templates" : {
    "default" : {
      ...
      "properties" : [
        {
          "name" : "shipping", 
          "value" : "FedEx", 
          "prompt" : "Select Shipping Method", 
          "suggest" : {
            "resource" : {
              "href" : "http://api.examples.org/shipping-options"
            }
          }
        }
      ]
    }
  }
}
```
The client would dereference the URL using `HTTP.GET`. The exchange (including the response) looks like this:

```
*** REQUEST
GET /shipping-options HTTP/2.0
Host: api.example.org
Accept: text/plain

*** RESPONSE
HTTP/2.0 200 OK
Content-Type: text/plain
Content-Length: nn

value=Federal Express&value=FedEx,
value=United Parcel Service&value=UPS,
value=DHL Express&value=DHL
```

**NOTE:** An array of name/value pairs MAY be returned as a an array of JSON objects if the `suggest.accept` attribute is set to `application/json`

```
*** REQUEST
GET /shipping-options HTTP/2.0
Host: api.example.org
Accept: application/json

*** RESPONSE
HTTP/2.0 200 OK
Content-Type: application/json
Content-Length: nn

[
  {"prompt" : "Federal Express", "value" : "FedEx"},
  {"prompt" : "United Parcel Service", "value" : "UPS"},
  {"prompt" : "DHL Express", "value" : "DHL"},
]
```


